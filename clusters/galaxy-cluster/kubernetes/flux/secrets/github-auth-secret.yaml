apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: ghcr-io-auth
spec:
  refreshInterval: 300s
  secretStoreRef:
    name: bitwarden-secretsmanager
    kind: ClusterSecretStore

  # So that I can edit the resulting secret
  target:

    template:
      type: kubernetes.io/dockerconfigjson 

      metadata:
        annotations: 
          reflector.v1.k8s.emberstack.com/reflection-allowed: "true"
          reflector.v1.k8s.emberstack.com/reflection-auto-enabled: "true"

      # Use inline templates to construct your desired config file that contains your secret
      data:
        .dockerconfigjson: '{"auths":{"ghcr.io":{"username":"B0bby31","password":"{{ .githubToken }}","auth":"{{ printf "B0bby31:%s" .githubToken | b64enc }}"}}}'

  data:
  - secretKey: githubToken
    remoteRef:
      key: "83dbc24f-0f9d-474e-8a2f-b34500dd83b0"