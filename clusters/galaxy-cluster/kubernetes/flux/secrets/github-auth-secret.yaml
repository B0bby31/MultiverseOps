apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: ghcr-io-auth
spec:
  refreshInterval: 300s
  secretStoreRef:
    name: bitwarden-secretsmanager
    kind: ClusterSecretStore

  # So that I can edit the resulting secret
  target:

    template:
      type: kubernetes.io/dockerconfigjson 

      metadata:
        annotations: 
          reflector.v1.k8s.emberstack.com/reflection-allowed: "true"
          reflector.v1.k8s.emberstack.com/reflection-auto-enabled: "true"

      # Use inline templates to construct your desired config file that contains your secret
      data:
        .dockerconfigjson: '{"auths":{"ghcr.io":{"username":"B0bby31","password":"{{ .github-token }}","auth":"{{ printf "%s:%s" B0bby31 .github-token | b64enc }}"}}}'

  data:
  - secretKey: github-token
    remoteRef:
      key: "223abe52-574f-420a-a88b-b21300e10fce"